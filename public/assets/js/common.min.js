let cmn={},ssd={blog:[]},IS_HISTORY_API=(cmn.saveFormData=e=>{var t=document.querySelector(e);if(t){t=new FormData(t);let a={};t.forEach((e,t)=>{a[t]=e}),sessionStorage.setItem(e,JSON.stringify(a))}},cmn.loadFormData=e=>{let o=document.querySelector(e);if(o){e=sessionStorage.getItem(e);if(e){let a=JSON.parse(e);Object.keys(a).forEach(t=>{var e=o.querySelector(`[name="${t}"]`);e&&("checkbox"===e.type||"radio"===e.type?o.querySelectorAll(`[name="${t}"]`).forEach(e=>{e.checked=e.value===a[t]}):"SELECT"===e.tagName&&Array.isArray(a[t])?Array.from(e.options).forEach(e=>{e.selected=a[t].includes(e.value)}):e.value=a[t])})}}},cmn.getAgeAtThatTime=(e,t="1975-07-09")=>{let a=e,o=t,s={},n=new Date,r=n.getFullYear(),l=n.getMonth()+1,i=n.getDate(),c;return a=a.replace(/-/g,""),o=o.replace(/-/g,""),l<10&&(l="0"+l),i<10&&(i="0"+i),c=r+""+l+i,0<a-o&&(s.age=Math.floor((a-o)/1e4),s.is_same=Math.floor((c-o)/1e4)===s.age),s},cmn.getDir=e=>{let t=e.split("/").filter(Boolean),a={};return 0===t.length?a.level1="home":t.forEach((e,t)=>{a["level"+(t+1)]=e}),a},cmn.getNrToBr=(e="")=>e=(e=(e=e.replace(/\r\n/g,"<br>")).replace(/\r/g,"<br>")).replace(/\n/g,"<br>"),cmn.getParam=e=>{let t=e||location.href,a=[],o={},s;for(s in t=1<t.split("?").length?t.split("?")[1]:t,a=t.split("&")){var n=a[s].split("=");2==n.length&&""!=n[1].trim()&&(o[n[0]]=n[1])}return o},history&&history.pushState&&void 0!==history.state),IS_HISTORY_PUSH=!1,CURRENT_TIME=(cmn.historyPushState=(e,t,a)=>{IS_HISTORY_API&&(history.pushState(e,t,a),IS_HISTORY_PUSH=!0)},cmn.historySet=t=>{IS_HISTORY_API&&$(window).on("popstate",function(e){e=e.originalEvent?.state||null;t&&t(e)})},$(document).on("mouseenter","a, button",function(){$(this).addClass("hover")}),$(document).on("mouseleave","a, button",function(){$(this).removeClass("hover")}),cmn.loadHtml=async(t,e={})=>{try{var a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/html"},body:JSON.stringify(e)});if(a.ok)return await a.text();throw new Error("HTTPエラー: "+a.status)}catch(e){return console.error("HTMLの取得に失敗:",e,t),null}},cmn.loadJson=async(e="")=>{if(""===e.trim())return{status:"fail",message:"ファイル名が指定されていません"};try{var t=await fetch("/api/index.php",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":CSRF_TOKEN},body:JSON.stringify({filename:e})});if(t.ok)return await t.json();throw new Error("HTTPエラー: "+t.status)}catch(e){return{status:"fail",message:e.message||"不明なエラーが発生しました"}}},cmn.pageScroll=(e=1,t=300,a)=>($("html, body").stop(),$("html").animate({scrollTop:e},t),$("body").animate({scrollTop:e},t,function(){a&&a()}),!1),(new Date).getTime()),scroll=(cmn.removeSplash=()=>{var e=1500-Math.min((new Date).getTime()-CURRENT_TIME,1500);setTimeout(()=>{$(".js-splash").remove()},e)},cmn.replaceTag=(e="")=>e.replace(/<[^>]*>/g,""),cmn.replaceUTF=(e="")=>e.replace(/u([\da-fA-F]{4})/g,"&#x$1;"),{}),IS_LOCALSTORAGE=(scroll.is_touch=!!("ontouchstart"in window&&"ontouchend"in window||navigator.msPointerEnabled||0<navigator.maxTouchPoints),scroll.eventstart=scroll.is_touch?"touchstart":"mousedown",scroll.eventmove=scroll.is_touch?"touchmove":"mousemove",scroll.eventend=scroll.is_touch?"touchend":"mouseup",scroll.isNumber=(e="")=>/^[0-9]+$/.test(e),(()=>{let e=new $.Event("resizestop"),t;$(window).on("resize",()=>{t&&clearTimeout(t),t=setTimeout(function(){$(window).trigger(e)},300)})})(),scroll.show=(a=".scroll",o={})=>{let s=$(a),e=$(".scroll__outer",s),n=$(".scroll__inner",s),r=$(".scroll__content",s),t=$(".scroll__bar",s);if(scroll.is_touch)return e.width("").height(""),!1;if(0===s.length||0===e.length||0===n.length||0===r.length)return!1;let l=o.direction||"horizontal",i="horizontal"===l,c="horizontal"===l?"left":"top",h="horizontal"===l?"width":"height",m="horizontal"===l?"height":"width",p="horizontal"===l?"margin-top":"margin-left",d="";o.bg&&(d+=a+" .scroll__bar::after{background:"+o.bg+"}",delete o.bg),o.color&&(d+=a+" .scroll__bar span::after{background:"+o.color+"}",delete o.color),o.size&&scroll.isNumber(o.size)&&(d+=a+" .scroll__bar span::after{"+m+":"+Math.min(o.size,20)+"px;"+p+": "+Math.min(o.size,20)/2*-1+"px}",delete o.size),o.bg_size&&scroll.isNumber(o.size)&&(d+=a+" .scroll__bar::after{"+m+":"+Math.min(o.bg_size,20)+"px;"+p+": "+Math.min(o.bg_size,20)/2*-1+"px}",delete o.bg_size),""!=d&&$("head").append("<style>"+d+"</style>"),n.css({overflow:"hidden"});var g=r[0].scrollWidth,u=r[0].scrollHeight;let f=i?s.width():s.height(),w=i?g:u;if(!(1<=Math.abs(f-w)&&1<w-f))return 0<t.length&&t.hide(),!1;t.show(),n.css({overflow:"auto"});let S=!1,v=0,_=0,b=0,y,T=0,E=0,I=0,O=!1;f-=o.padding||0;n.on("scroll",()=>{if(S)return!1;var e=i?r.position().left:r.position().top;let t=Math.ceil(Math.abs(e)/w*100);100<t+E&&(t=100-E),x.css(c,t+"%")}),$(window).on("resize",()=>{O=!0}),$(window).on("resizestop",()=>{var e=$(".scroll__bar-control",s),t=i?e.width():e.height();y=i?window.innerWidth:window.innerHeight,b!=y&&(scroll.show(a,o),0<e.length&&(T=f-t),O=!1,b=y)}),0===t.length&&(s.append(`
      <div class="scroll__bar scroll__bar--${l}">
        <span class="scroll__bar-control"></span>
      </div>
    `),t=$(".scroll__bar",s),o.padding)&&t.css(h,"calc(100% - "+o.padding+"px)").css(c,o.padding/2+"px");let x=$(".scroll__bar-control",s);i?(e.height(u),n.height(u+30)):(e.width(g),n.width(g+30)),E=Math.ceil(f/w*100),I=i?(x.width(E+"%"),x.width()):(x.height(E+"%"),x.height()),T||(T=f-I,(()=>{let t;x.on(scroll.eventstart,function(e){S=!0,t=i?r.position().left:r.position().top,v=i?e.pageX:e.pageY,_=Math.floor(Math.abs(t)/w*f)}),$(document).on(scroll.eventmove,function(a){if(S&&!O){a=(i?a.pageX:a.pageY)-v,a=_+a;let e=0,t;a=Math.max(0,a),a=Math.min(Math.ceil(T),a),e=Math.ceil(a/f*100),t=w*(e/100),100<e+E&&(e=100-E),x.css(c,e+"%"),i?n.scrollLeft(t):n.scrollTop(t)}}),$(document).on(scroll.eventend,function(){S=!1})})())},cmn.shuffleArray=(e=[])=>{let t,a;for(t=e.length;1<t;t--)a=Math.floor(Math.random()*t),[e[a],e[t-1]]=[e[t-1],e[a]];return e},cmn.sticky=(e="",t,a)=>{let o=document.querySelector(e);if(""===e.trim()||!o||"function"!=typeof t||"function"!=typeof a)return!1;let s=o.getBoundingClientRect().top;window.addEventListener("scroll",()=>{var e=o.getBoundingClientRect().top;e===s?t():s,s=e})},"localStorage"in window&&null!==window.localStorage),IS_SESSIONSTORAGE="sessionStorage"in window&&null!==window.sessionStorage;cmn.storageLS=(t,e)=>{let a=null;if(IS_LOCALSTORAGE&&void 0!==t)if(void 0!==e)localStorage[t]="object"==typeof e?JSON.stringify(e):e;else try{a=new Function("return "+localStorage[t])()}catch(e){a=localStorage[t]}return a},cmn.storageDelLS=e=>{localStorage.removeItem(e)},cmn.storageSS=(t,e)=>{let a=null;if(IS_SESSIONSTORAGE&&void 0!==t)if(void 0!==e)sessionStorage[t]="object"==typeof e?JSON.stringify(e):e;else try{a=new Function("return "+sessionStorage[t])()}catch(e){a=sessionStorage[t]}return a},cmn.storageDelSS=e=>{sessionStorage.removeItem(e)},$(()=>{let i=!1;$(document).on("click",".js-comment-submit",async function(){let e=$(this),t=e.closest(".js-form-comment"),a=$('[name="comment"]',t),o=$('[name="author"]',t),s=$(".js-comment-notification",t),n=$('[name="comment_post_ID"]',t).val();var r,l=new FormData(t[0]),l=Object.fromEntries(l.entries());if(a.on("input",()=>{s.removeClass("caution").hide()}),!i){if(""===a.val().trim())return s.addClass("caution").html("コメントが入力されていることをご確認の上、もう一度お試しください。").show(),!1;i=!0,e.html('<span class="animation-blinker">送信中...</span>'),$(".js-comment-list").attr("data-id",n),"success"===await(await fetch("/assets/ajax/parts/post-comment-form.php",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":CSRF_TOKEN},body:JSON.stringify(l)})).text()?(s.removeClass("caution").html("コメントありがとうございます！").show(),l=`
          <li class="comment__unit">
            <p class="comment__unit-text">${cmn.getNrToBr(a.val().trim().replace(/</g,"＜").replace(/>/g,"＞"))}</p>
            <p class="comment__unit-info">
              <span>${cmn.getNrToBr(o.val().trim().replace(/</g,"＜").replace(/>/g,"＞"))}</span>
              <time>now</time>
            </p>
          </li>
        `,0<(r=$('.js-comment-list[data-id="'+n+'"]')).length&&(0<$("li",r).length?$("li:first-child",r).before(l):r.append(l)),a.val(""),o.val(""),PAGES=PAGES.filter(e=>e.data.id!==n)):s.addClass("caution").html("コメント送信できませんでした。恐れ入りますが、もう一度お試しください。").show(),i=!1,e.html("コメントする")}return!1})}),ssd.changePage=async(h={},m)=>{let p=$(".js-article"),d=$(".js-article-inner"),g=$(".js-loading");p.animate({top:-10,opacity:0},350,async function(){g.show(),h.path||(h.path="404");var e="https://simplesimples.com"+h.path,t=h.path.replace(/^\/|\/$/g,"").split("/"),a={};let o="シンプルシンプルデザイン",s="",n="",r,l,i="";switch(t[0]){case"":o="",s="",l=await fetch("/assets/include/pages/home.php"),i=await l.text();break;case"blog":o="個人ブログは引っ越しました | "+o,s="個人ブログは別ドメインに引っ越ししました。ぜひ、引っ越し先をご覧ください。",l=await fetch(`/assets/include/pages/${t[0]}.php`),i=await l.text();break;case"service":o="サービス | "+o,s="",l=await fetch(`/assets/include/pages/${t[0]}.php`),i=await l.text();break;case"about":o="事業内容 | "+o,s="",l=await fetch(`/assets/include/pages/${t[0]}.php`),i=await l.text();break;case"contact":o="お問い合わせ | "+o,s="",l=await fetch(`/assets/include/pages/${t[0]}.php`),i=await l.text();break;case"privacy":o="プライバシーポリシー | "+o,s="",l=await fetch(`/assets/include/pages/${t[0]}.php`),i=await l.text();break;case"post":o="制作ブログ | "+o,s="",n="",l=await fetch(`/assets/include/pages/${t[0]}.php`),i=await l.text();break;case"search":var c=cmn.getParam(location.search).q;if(!c)return void ssd.changePage();c=decodeURIComponent(c),o=`制作ブログ「${c}」の検索結果 | `+o;s=`制作ブログ内で「${c}」を含む記事は、10件見つかりました。`,n="",i=t[0];break;case"web":case"video":case"overview":let e="";"web"===t[0]&&t[3]?e=t[3]:"web"!=t[0]&&t[2]&&(e=t[2]),i=e?(e=decodeURIComponent(e),r=await ssd.getBlogData(e),o="",s="",n="",r?.html||""):(o="",s="",n="",await(l=await fetch(`/assets/include/pages/${t[0]}.php`)).text());break;default:o="表示できませんでした | "+o,s="",l=await fetch("/assets/include/pages/system.php"),i=await l.text()}$("title").html(o),$('meta[name="description"]').attr("content",s),$('meta[property="og:image"]').attr("content",n),$('link[rel="canonical"]').attr("href",e),g.hide(),d.html(i),p.animate({top:0,opacity:1},350),m&&h.path!=ssd.last_history&&(ssd.last_history=h.path,a.path=h.path,r&&(a.data=r),cmn.historyPushState(a,"",h.path))})},ssd.getBlogData=e=>{},$(()=>{let t=location.pathname;cmn.historySet(e=>{ssd.changePage(e)}),$(".js-link").on("click",function(){var e=$(this).attr("href");return ssd.changePage({path:e},!0),!1}),Promise.all([cmn.loadJson("all-data.json"),cmn.loadJson("lifequotes.json"),cmn.loadJson("photo.json")]).then(e=>{console.log(e),ssd.changePage({path:t}),cmn.removeSplash()}).catch(e=>{ssd.changePage({path:"/system/"}),cmn.removeSplash()})});