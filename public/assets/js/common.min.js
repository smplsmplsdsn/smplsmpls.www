let cmn={},ssd={post:[]},IS_HISTORY_API=(cmn.saveFormData=t=>{var e=document.querySelector(t);if(e){e=new FormData(e);let s={};e.forEach((t,e)=>{s[e]=t}),sessionStorage.setItem(t,JSON.stringify(s))}},cmn.loadFormData=t=>{let a=document.querySelector(t);if(a){t=sessionStorage.getItem(t);if(t){let s=JSON.parse(t);Object.keys(s).forEach(e=>{var t=a.querySelector(`[name="${e}"]`);t&&("checkbox"===t.type||"radio"===t.type?a.querySelectorAll(`[name="${e}"]`).forEach(t=>{t.checked=t.value===s[e]}):"SELECT"===t.tagName&&Array.isArray(s[e])?Array.from(t.options).forEach(t=>{t.selected=s[e].includes(t.value)}):t.value=s[e])})}}},cmn.getAgeAtThatTime=(t,e="1975-07-09")=>{let s=t,a=e,o={},n=new Date,i=n.getFullYear(),l=n.getMonth()+1,r=n.getDate(),c;return s=s.replace(/-/g,""),a=a.replace(/-/g,""),l<10&&(l="0"+l),r<10&&(r="0"+r),c=i+""+l+r,0<s-a&&(o.age=Math.floor((s-a)/1e4),o.is_same=Math.floor((c-a)/1e4)===o.age),o},cmn.getDir=t=>{let e=t.split("/").filter(Boolean),s={};return 0===e.length?s.level1="home":e.forEach((t,e)=>{s["level"+(e+1)]=t}),s},cmn.getNrToBr=(t="")=>t=(t=(t=t.replace(/\r\n/g,"<br>")).replace(/\r/g,"<br>")).replace(/\n/g,"<br>"),cmn.getParam=t=>{let e=t||location.href,s=[],a={},o;for(o in e=1<e.split("?").length?e.split("?")[1]:e,s=e.split("&")){var n=s[o].split("=");2==n.length&&""!=n[1].trim()&&(a[n[0]]=n[1])}return a},history&&history.pushState&&void 0!==history.state),IS_HISTORY_PUSH=!1,CURRENT_TIME=(cmn.historyPushState=(t,e,s)=>{IS_HISTORY_API&&(history.pushState(t,e,s),IS_HISTORY_PUSH=!0)},cmn.historySet=e=>{IS_HISTORY_API&&$(window).on("popstate",function(t){t=t.originalEvent?.state||null;e&&e(t)})},$(document).on("mouseenter","a, button",function(){$(this).addClass("hover")}),$(document).on("mouseleave","a, button",function(){$(this).removeClass("hover")}),cmn.loadHtml=async(t="")=>{if(""===t.trim())return{status:"fail",message:"ファイル名が指定されていません"};try{var e=await fetch(t,{method:"GET",headers:{"X-CSRF-Token":CSRF_TOKEN}});if(e.ok)return await e.text();throw new Error("HTTPエラー: "+e.status)}catch(t){return""}},cmn.loadJson=async(t="")=>{if(""===t.trim())return{status:"fail",message:"ファイル名が指定されていません"};try{var e=await fetch("/api/index.php",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":CSRF_TOKEN},body:JSON.stringify({filename:t})});if(e.ok)return await e.json();throw new Error("HTTPエラー: "+e.status)}catch(t){return{status:"fail",message:t.message||"不明なエラーが発生しました"}}},cmn.pageScroll=(t=1,e=300,s)=>($("html, body").stop(),$("html").animate({scrollTop:t},e),$("body").animate({scrollTop:t},e,function(){s&&s()}),!1),(new Date).getTime()),scroll=(cmn.removeSplash=()=>{var t=1500-Math.min((new Date).getTime()-CURRENT_TIME,1500);setTimeout(()=>{$(".js-splash").remove()},t)},cmn.replaceTag=(t="")=>t.replace(/<[^>]*>/g,""),cmn.replaceUTF=(t="")=>t.replace(/u([\da-fA-F]{4})/g,"&#x$1;"),{}),IS_LOCALSTORAGE=(scroll.is_touch=!!("ontouchstart"in window&&"ontouchend"in window||navigator.msPointerEnabled||0<navigator.maxTouchPoints),scroll.eventstart=scroll.is_touch?"touchstart":"mousedown",scroll.eventmove=scroll.is_touch?"touchmove":"mousemove",scroll.eventend=scroll.is_touch?"touchend":"mouseup",scroll.isNumber=(t="")=>/^[0-9]+$/.test(t),(()=>{let t=new $.Event("resizestop"),e;$(window).on("resize",()=>{e&&clearTimeout(e),e=setTimeout(function(){$(window).trigger(t)},300)})})(),scroll.show=(s=".scroll",a={})=>{let o=$(s),t=$(".scroll__outer",o),n=$(".scroll__inner",o),i=$(".scroll__content",o),e=$(".scroll__bar",o);if(scroll.is_touch)return t.width("").height(""),!1;if(0===o.length||0===t.length||0===n.length||0===i.length)return!1;let l=a.direction||"horizontal",r="horizontal"===l,c="horizontal"===l?"left":"top",m="horizontal"===l?"width":"height",h="horizontal"===l?"height":"width",p="horizontal"===l?"margin-top":"margin-left",d="";a.bg&&(d+=s+" .scroll__bar::after{background:"+a.bg+"}",delete a.bg),a.color&&(d+=s+" .scroll__bar span::after{background:"+a.color+"}",delete a.color),a.size&&scroll.isNumber(a.size)&&(d+=s+" .scroll__bar span::after{"+h+":"+Math.min(a.size,20)+"px;"+p+": "+Math.min(a.size,20)/2*-1+"px}",delete a.size),a.bg_size&&scroll.isNumber(a.size)&&(d+=s+" .scroll__bar::after{"+h+":"+Math.min(a.bg_size,20)+"px;"+p+": "+Math.min(a.bg_size,20)/2*-1+"px}",delete a.bg_size),""!=d&&$("head").append("<style>"+d+"</style>"),n.css({overflow:"hidden"});var u=i[0].scrollWidth,g=i[0].scrollHeight;let f=r?o.width():o.height(),_=r?u:g;if(!(1<=Math.abs(f-_)&&1<_-f))return 0<e.length&&e.hide(),!1;e.show(),n.css({overflow:"auto"});let w=!1,v=0,S=0,b=0,y,T=0,I=0,j=0,E=!1;f-=a.padding||0;n.on("scroll",()=>{if(w)return!1;var t=r?i.position().left:i.position().top;let e=Math.ceil(Math.abs(t)/_*100);100<e+I&&(e=100-I),O.css(c,e+"%")}),$(window).on("resize",()=>{E=!0}),$(window).on("resizestop",()=>{var t=$(".scroll__bar-control",o),e=r?t.width():t.height();y=r?window.innerWidth:window.innerHeight,b!=y&&(scroll.show(s,a),0<t.length&&(T=f-e),E=!1,b=y)}),0===e.length&&(o.append(`
      <div class="scroll__bar scroll__bar--${l}">
        <span class="scroll__bar-control"></span>
      </div>
    `),e=$(".scroll__bar",o),a.padding)&&e.css(m,"calc(100% - "+a.padding+"px)").css(c,a.padding/2+"px");let O=$(".scroll__bar-control",o);r?(t.height(g),n.height(g+30)):(t.width(u),n.width(u+30)),I=Math.ceil(f/_*100),j=r?(O.width(I+"%"),O.width()):(O.height(I+"%"),O.height()),T||(T=f-j,(()=>{let e;O.on(scroll.eventstart,function(t){w=!0,e=r?i.position().left:i.position().top,v=r?t.pageX:t.pageY,S=Math.floor(Math.abs(e)/_*f)}),$(document).on(scroll.eventmove,function(s){if(w&&!E){s=(r?s.pageX:s.pageY)-v,s=S+s;let t=0,e;s=Math.max(0,s),s=Math.min(Math.ceil(T),s),t=Math.ceil(s/f*100),e=_*(t/100),100<t+I&&(t=100-I),O.css(c,t+"%"),r?n.scrollLeft(e):n.scrollTop(e)}}),$(document).on(scroll.eventend,function(){w=!1})})())},cmn.shuffleArray=(t=[])=>{let e,s;for(e=t.length;1<e;e--)s=Math.floor(Math.random()*e),[t[s],t[e-1]]=[t[e-1],t[s]];return t},cmn.sticky=(t="",e,s)=>{let a=document.querySelector(t);if(""===t.trim()||!a||"function"!=typeof e||"function"!=typeof s)return!1;let o=a.getBoundingClientRect().top;window.addEventListener("scroll",()=>{var t=a.getBoundingClientRect().top;t===o?e():o,o=t})},"localStorage"in window&&null!==window.localStorage),IS_SESSIONSTORAGE="sessionStorage"in window&&null!==window.sessionStorage;cmn.storageLS=(e,t)=>{let s=null;if(IS_LOCALSTORAGE&&void 0!==e)if(void 0!==t)localStorage[e]="object"==typeof t?JSON.stringify(t):t;else try{s=new Function("return "+localStorage[e])()}catch(t){s=localStorage[e]}return s},cmn.storageDelLS=t=>{localStorage.removeItem(t)},cmn.storageSS=(e,t)=>{let s=null;if(IS_SESSIONSTORAGE&&void 0!==e)if(void 0!==t)sessionStorage[e]="object"==typeof t?JSON.stringify(t):t;else try{s=new Function("return "+sessionStorage[e])()}catch(t){s=sessionStorage[e]}return s},cmn.storageDelSS=t=>{sessionStorage.removeItem(t)},$(()=>{let r=!1;$(document).on("click",".js-comment-submit",async function(){let t=$(this),e=t.closest(".js-form-comment"),s=$('[name="comment"]',e),a=$('[name="author"]',e),o=$(".js-comment-notification",e),n=$('[name="comment_post_ID"]',e).val();var i,l=new FormData(e[0]),l=Object.fromEntries(l.entries());if(s.on("input",()=>{o.removeClass("caution").hide()}),!r){if(""===s.val().trim())return o.addClass("caution").html("コメントが入力されていることをご確認の上、もう一度お試しください。").show(),!1;r=!0,t.html('<span class="animation-blinker">送信中...</span>'),$(".js-comment-list").attr("data-id",n),"success"===await(await fetch("/assets/ajax/parts/post-comment-form.php",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":CSRF_TOKEN},body:JSON.stringify(l)})).text()?(o.removeClass("caution").html("コメントありがとうございます！").show(),l=`
          <li class="comment__unit">
            <p class="comment__unit-text">${cmn.getNrToBr(s.val().trim().replace(/</g,"＜").replace(/>/g,"＞"))}</p>
            <p class="comment__unit-info">
              <span>${cmn.getNrToBr(a.val().trim().replace(/</g,"＜").replace(/>/g,"＞"))}</span>
              <time>now</time>
            </p>
          </li>
        `,0<(i=$('.js-comment-list[data-id="'+n+'"]')).length&&(0<$("li",i).length?$("li:first-child",i).before(l):i.append(l)),s.val(""),a.val(""),PAGES=PAGES.filter(t=>t.data.id!==n)):o.addClass("caution").html("コメント送信できませんでした。恐れ入りますが、もう一度お試しください。").show(),r=!1,t.html("コメントする")}return!1})}),ssd.changePage=async(p={},d)=>{let u=$(".js-article"),g=$(".js-article-inner"),f=$(".js-loading");u.animate({top:-10,opacity:0},350,async function(){f.show(),p.path||(p.path="404");var t="https://simplesimples.com"+p.path,e=p.path.replace(/^\/|\/$/g,"").split("/"),s={};let a="シンプルシンプルデザイン",o="",n="",i,l,r="",c=!1,m=!1;switch(e[0]){case"":a="",o="",l=await fetch("/assets/include/pages/home.php"),r=await l.text();break;case"blog":a="個人ブログは引っ越しました | "+a,o="個人ブログは別ドメインに引っ越ししました。ぜひ、引っ越し先をご覧ください。",l=await fetch(`/assets/include/pages/${e[0]}.php`),r=await l.text();break;case"service":a="サービス | "+a,o="",l=await fetch(`/assets/include/pages/${e[0]}.php`),r=await l.text();break;case"about":a="事業内容 | "+a,o="",l=await fetch(`/assets/include/pages/${e[0]}.php`),r=await l.text();break;case"contact":a="お問い合わせ | "+a,o="",l=await fetch(`/assets/include/pages/${e[0]}.php`),r=await l.text();break;case"privacy":a="プライバシーポリシー | "+a,o="",l=await fetch(`/assets/include/pages/${e[0]}.php`),r=await l.text();break;case"post":a="制作ブログ | "+a,o="",n="",l=await fetch(`/assets/include/pages/${e[0]}.php`),r=await l.text();break;case"search":var h=cmn.getParam(location.search).q;if(!h)return void ssd.changePage();h=decodeURIComponent(h),a=`制作ブログ「${h}」の検索結果 | `+a;o=`制作ブログ内で「${h}」を含む記事は、10件見つかりました。`,n="",r=e[0];break;case"web":case"video":case"overview":let t="";"web"===e[0]&&e[3]?t=e[3]:"web"!=e[0]&&e[2]&&(t=e[2]),t?(m=!0,t=decodeURIComponent(t),(post_list=ssd.getPostListInfo(t))&&(a=post_list.title,o=post_list.description,n=post_list.img,r=await ssd.getPostData(post_list.id))&&""!=r?i={id:post_list.id,html:r}:c=!0):(a="",o="",n="",l=await fetch(`/assets/include/pages/${e[0]}.php`),r=await l.text());break;default:c=!0}c&&(a="表示できませんでした | "+a,o="",l=await fetch("/assets/include/pages/system.php"),r=await l.text()),$("title").html(a),$('meta[name="description"]').attr("content",o),$('meta[property="og:image"]').attr("content",n),$('link[rel="canonical"]').attr("href",t),f.hide(),g.html(r),u.animate({top:0,opacity:1},350),m&&hljs.highlightAll(),d&&p.path!=ssd.last_history&&(ssd.last_history=p.path,s.path=p.path,i&&(s.data=i),cmn.historyPushState(s,"",p.path))})},ssd.getPostData=async e=>{let t=ssd.post.find(t=>t.id==e);if(t)return"aruyo TODO";if(!(t=await ssd.loadPost(e))?.content)return"TODO ネット切れてる場合";ssd.post.push(t),console.log(t);var s=t?.image?`<figure class="post__mainvisual mainvisual" style="background-image: url(${t.image});"></figure>`:"";let a=t?.acf?.update||"";a&&(o=a.split("-"),a=`(${o[0]}年${o[1]}月${o[2]}日更新)`);var o=encodeURIComponent("htttps://simplesimples.com"+t.link),n=encodeURIComponent(t.title),i=encodeURIComponent("【シンプルシンプルデザイン】"),i=`
<ul class="sns-list post__sns-list">
  ${t?.acf?.github?`<li><a class="sns-github" href="${t.acf.github}"><span class="icon-github"></span></a></li>`:""}
  <li><a href="${`https://x.com/share?url=${o}&text=`+n+i}"><span class="icon-twitter"></span></a></li>
  <li><a href="${"https://www.facebook.com/sharer/sharer.php?u="+o}"><span class="icon-facebook"></span></a></li>
  <li><a href="${`https://line.me/R/msg/text/?${i}${n} `+o}"><span class="icon-line"></span></a></li>
</ul>
  `;return`
<main class="post js-post">
  ${s}
  <header class="post__header">

    <p class="post__datetime-and-category">
      <span class="post__datetime">
          <time datetime="${t.dateitme}">${t.date}</time>
          ${a}
      </span>
      <span class="post__category">${t.category_name}</span>
    </p>

    <h1 class="post__title">${t.title}</h1>
  </header>

  ${i}

  <div class="content post__content js-post-content">
    ${t.content}
  </div>

  ${i}

  <div class="post__comment">
    <aside class="comment js-comment">
      <div class="comment__inner">
        <h1 class="comment__title">COMMENT</h1>
        <p class="comment__description js-comment__description">最後まで目を通していただき、ありがとうございます。この記事はいかがでしたか？</p>
        <div class="comment__form-outer">
          <form id="commentform" class="comment__form js-form-comment" method="post">
            <textarea name="comment"></textarea>
            <div class="comment__info">
              <input class="comment__name" name="author" type="text" value="" placeholder="ニックネーム">
              <input class="comment__submit js-comment-submit" name="submit" type="submit" value="コメントする">
            </div>
            <input type="hidden" name="comment_post_ID" value="${t.id}">
            <input type="hidden" name="comment_parent" value="0" />
            <p class="comment__message js-comment-message"><strong>コメント送信できませんでした。恐れ入りますが、コメントが入力されていることをご確認の上、もう一度「コメント送信」を選択してください。</strong></p>
          </form>
        </div>

        <div class="comment__list">


        </div>
      </div>
    </aside>
  </div>
</main>
  `},ssd.getPostListInfo=(e="")=>ssd.list.find(t=>decodeURIComponent(t.slug.replace(/^"|"$/g,""))===e)||null,ssd.loadPost=async(t="")=>{if(""===t)return{status:"fail",message:"投稿IDが指定されていません"};try{var e=await fetch("/api/post.php?post_id="+t,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":CSRF_TOKEN}});if(e.ok)return await e.json();throw new Error("HTTPエラー: "+e.status)}catch(t){return{status:"fail",message:t.message||"不明なエラーが発生しました"}}},$(()=>{let e=location.pathname;cmn.historySet(t=>{ssd.changePage(t)}),Promise.all([cmn.loadJson("businessquotes.json"),cmn.loadJson("list-comment.json"),cmn.loadJson("list-popular.json"),cmn.loadJson("list.json"),cmn.loadJson("category.json"),cmn.loadHtml("/assets/include/post-nav.html")]).then(t=>{ssd.businessquotes={},ssd.businessquotes.data=t[0],ssd.businessquotes.data=cmn.shuffleArray(ssd.businessquotes.data),ssd.list_comment=t[1],ssd.list_popular=t[2],ssd.list=t[3],ssd.category={},ssd.category.data=t[4],ssd.category.html=t[5],ssd.changePage({path:e}),cmn.removeSplash()}).catch(t=>{ssd.changePage({path:"/system/"}),cmn.removeSplash()})}),$(document).on("click",".js-link",function(){var t=$(this).attr("href");return ssd.changePage({path:t},!0),!1});